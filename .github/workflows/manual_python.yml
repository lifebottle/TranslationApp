
name: Manual python

on:
  workflow_dispatch
jobs:

  startVM:
    runs-on: ubuntu-latest
    steps:
    
    #Test again
    - name: Login to AZ CLI
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    
    - run:
          az vm start -g ${{ secrets.AZURE_RESSOURCE }} -n ${{ secrets.AZURE_VM }}

  pythonCode:
    runs-on: self-hosted
    needs: startVM
    steps:
    
    - uses: actions/checkout@v2
    - name: Checkout
      uses: actions/checkout@v2
      with:
        repository: SymphoniaLauren/Tales-of-Rebirth
    
    #Try 2
    - name: Change directory
      run:
        cd ../../PythonLib/

    - name: Run code
      uses: actions/setup-python@v2
      with:
        python-version: '3.8' # Version range or exact version of a Python version to use, using SemVer's version range syntax
        architecture: 'x64' # optional x64 or x86. Defaults to x64 if not specified
    - run: 
        python ToolsTales_Executable.py --game TOR unpack Main 
          
  closeVM:
    runs-on: ubuntu-latest
    needs: pythonCode
    steps:

    - name: Login to AZ CLI
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    
    - run:
          az vm stop -g ${{ secrets.AZURE_RESSOURCE }} -n ${{ secrets.AZURE_VM }}
        
    
    
